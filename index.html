<!DOCTYPE html>
<html>
<head>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js'></script>
    <meta charset='utf-8' />
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/icon?family=Material+Icons' rel='stylesheet' />
    <link href='stylesheets/stylesheet.css' type='text/css' rel='stylesheet' />
    <title>Demo App</title>
</head>
<body>

<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.css' type='text/css' />

<div id='map'></div>
<div id='console'>
    <div class='card'>
        <h2 class='card_heading'>MAP LAYERS</h2>
        <ul id='layers_list'>
            <li id='layer_default' data-color='steelblue'>
                <i class='material-icons'>bubble_chart</i>
                <div>
                    <h2 class='no_margin_heading'>Sensors</h2>
                    <s1>A description of this layer goes here</s1>
                </div>

            </li>
            <li id='layer_alt_1' data-color='dodgerblue'>
                <i class='material-icons'>waves</i>
                <div>
                    <h2 class='no_margin_heading'>Inundation</h2>
                    <s1>A description of this layer goes here</s1>
                </div>

            </li>
            <li id='layer_alt_2' data-color='firebrick'>
                <i class='material-icons'>graphic_eq</i>
                <div>
                    <h2 class='no_margin_heading'>Predicted risk</h2>
                    <s1>A description of this layer goes here</s1>
                </div>

            </li>
        </ul>
    </div>

    <div class='card'>
        <h2 class='card_heading'>MAP LEGEND</h2>

        <div class='legend_row'>
            <div class = 'label' id='sensor'></div>
            <div class='label'>Sea-level sensors</div>
        </div>
        <div class='legend_row' data-layer='layer_alt_1'>
            <div class='colors'></div>
            <div class='legend_text'>
                <div class='label third'>5ft</div>
                <div class='label third'>10ft</div>
                <div class='label third'>15ft</div>
            </div>
        </div>

        <div class='legend_row' data-layer='layer_alt_2'>
            <div class='colors'></div>
            <div class='legend_text'>
                <div id='low_risk_label' class='label'>Low risk</div>
                <div id='high_risk_label' class='label'>High risk</div>
            </div>
        </div>
    </div>
</div>
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoicGNoYXdsYTgiLCJhIjoiY2pvb2IxeHhjMGFpbzNwcXJzbjkxenphbCJ9.PLLJazTRjDbljE9IniyWpg';
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v10',
    center: {lon: -81.2, lat: 32}, // starting position
    zoom: 9.6, // starting zoom
    hash: true
});

const nav = new mapboxgl.NavigationControl();
map.addControl(nav, 'bottom-right');

map.addControl(new MapboxGeocoder({
    accessToken: mapboxgl.accessToken
}), 'top-left');

map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
}), 'bottom-right');

const framesPerSecond = 15; 
const initialOpacity = 1
const initialRadius = 6;
const maxRadius = 15;

let radius = initialRadius;
let opacity = initialOpacity;
map.on('load', function () {
    // Add a source and layer displaying a point which will be animated in a circle.
    map.addSource('point', {
        'type': 'geojson',
        'data': {
            'type': 'Point',
            'coordinates': [
                -80.88, 32.01
            ]
        }
    });
    map.addLayer({
        'id': 'point',
        'source': 'point',
        'type': 'circle',
        'paint': {
            'circle-radius': initialRadius,
            'circle-radius-transition': {duration: 0},
            'circle-opacity-transition': {duration: 0},
            'circle-color': '#007cbf'
        }
    });
    map.addLayer({
        'id': 'point1',
        'source': 'point',
        'type': 'circle',
        'paint': {
            'circle-radius': initialRadius,
            'circle-color': '#007cbf'
        }
    });
    function animateMarker(timestamp) {
        setTimeout(function(){
            requestAnimationFrame(animateMarker);
            radius += (maxRadius - radius) / framesPerSecond;
            opacity -= ( .9 / framesPerSecond );
            if (opacity <= 0) {
                radius = initialRadius;
                opacity = initialOpacity;
            } 
            map.setPaintProperty('point', 'circle-radius', radius);
            map.setPaintProperty('point', 'circle-opacity', opacity);

        }, 1000 / framesPerSecond);
        
    }
    // Start the animation.
    animateMarker(0);
});

layer_default = $('#layer_default')[0]
$(layer_default).css('color', layer_default.dataset.color)

$('li').on('click',function() {
    $('li').each(function() {   
        $(this).css('color', 'black')
    });
    const id = this.id;
    $('[data-layer^="layer_"]').each(function() {
        if (this.dataset.layer === id) {
            $(this).show();
        } else {
            $(this).hide();
        }
    });
    $(this).css('color', this.dataset.color)
});

</script>
</body>
</html>